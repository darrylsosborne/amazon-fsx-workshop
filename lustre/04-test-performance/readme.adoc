= Test Performance
:toc:
:icons:
:linkattrs:
:imagesdir: ../../resources/images


== Summary

This section will test the performance of Amazon FSx for Lustre.


== Duration

NOTE: It will take approximately 15 minutes to complete this section.


== Step-by-step Guide

IMPORTANT: Read through all steps below before continuing.

=== Smallfile Read tests

. Open two (2) SSH terminal session windows connected to *Linux Instance 0*
+
Start `*nload*` in one of the SSH terminal session windows.
+
[source,bash]
----
nload -u M

----

. *_Copy_* the scripts below and *_execute_* them in the other SSH terminal session window.
+
Write, read, stat, append, rename, and delete a large number of smallfiles. *_Run_* these commands in order and review the results.
+
Write (create) 32,000 4KiB files
+
[source,bash]
----
job_name=$(echo $(uuidgen)| grep -o ".\{6\}$")
prefix=$(echo $(uuidgen)| grep -o ".\{6\}$")
path=/mnt/fsx/${job_name}
sudo mkdir -p ${path}

threads=64
file_size=4
file_count=500
operation=create
same_dir=N

sudo python ~/smallfile/smallfile_cli.py \
--operation ${operation} \
--threads ${threads} \
--file-size ${file_size} \
--files ${file_count} \
--same-dir ${same_dir} \
--hash-into-dirs Y \
--prefix ${prefix} \
--dirs-per-dir ${file_count} \
--files-per-dir ${file_count} \
--top ${path} &

----
+
. Read 32,000 4KiB files
+
[source,bash]
----
operation=read

sudo python ~/smallfile/smallfile_cli.py \
--operation ${operation} \
--threads ${threads} \
--file-size ${file_size} \
--files ${file_count} \
--same-dir ${same_dir} \
--hash-into-dirs Y \
--prefix ${prefix} \
--dirs-per-dir ${file_count} \
--files-per-dir ${file_count} \
--top ${path} &

----


== Next section

Click the button below to go to the next section.

image::05-monitor-performance.png[link=../05-monitor-performance/, align="left",width=420]




